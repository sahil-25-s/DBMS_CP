{% extends "base.html" %}

{% block title %}Manage Movies - Admin{% endblock %}

{% block content %}
<div class="container">
    <div class="admin-container">
        <div class="admin-header">
            <div class="header-left">
                <h1><i class="fas fa-film"></i> Manage Movies</h1>
                <p>Add, edit, and manage movie listings</p>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="showAddMovieModal()">
                    <i class="fas fa-plus"></i>
                    Add New Movie
                </button>
                <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </a>
            </div>
        </div>

        <div class="movies-table-container">
            <div class="table-header">
                <h3><i class="fas fa-list"></i> Movie List</h3>
                <div class="table-actions">
                    <input type="text" id="searchMovies" placeholder="Search movies..." class="search-input">
                    <select id="genreFilter" class="filter-select">
                        <option value="">All Genres</option>
                        <option value="Action">Action</option>
                        <option value="Comedy">Comedy</option>
                        <option value="Drama">Drama</option>
                        <option value="Horror">Horror</option>
                        <option value="Romance">Romance</option>
                        <option value="Sci-Fi">Sci-Fi</option>
                        <option value="Thriller">Thriller</option>
                    </select>
                </div>
            </div>

            {% if movies %}
            <div class="table-responsive">
                <table class="admin-table" id="moviesTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Poster</th>
                            <th>Title</th>
                            <th>Genre</th>
                            <th>Duration</th>
                            <th>Language</th>
                            <th>Release Date</th>
                            <th>Rating</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for movie in movies %}
                        <tr>
                            <td>{{ movie.id }}</td>
                            <td>
                                <div class="movie-poster-small">
                                    {% if movie.image_url %}
                                        <img src="{{ movie.image_url }}" alt="{{ movie.title }}" onerror="this.src='{{ url_for('static', filename='images/default-movie.jpg') }}'">
                                    {% else %}
                                        <img src="{{ url_for('static', filename='images/default-movie.jpg') }}" alt="{{ movie.title }}">
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                <div class="movie-title-cell">
                                    <strong>{{ movie.title }}</strong>
                                    <small>{{ movie.description[:50] }}...</small>
                                </div>
                            </td>
                            <td>
                                <span class="genre-tag">{{ movie.genre }}</span>
                            </td>
                            <td>{{ movie.duration }} mins</td>
                            <td>{{ movie.language }}</td>
                            <td>{{ movie.release_date.strftime('%Y-%m-%d') if movie.release_date else 'TBA' }}</td>
                            <td>
                                <div class="rating-cell">
                                    <span class="rating-value">{{ "%.1f"|format(movie.rating) }}</span>
                                    <div class="rating-stars">
                                        {% for i in range(1, 6) %}
                                            {% if i <= movie.rating %}
                                                <i class="fas fa-star"></i>
                                            {% else %}
                                                <i class="far fa-star"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon btn-view" onclick="viewMovie({{ movie.id }})" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon btn-edit" onclick="editMovie({{ movie.id }})" title="Edit Movie">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon btn-delete" onclick="deleteMovie({{ movie.id }}, '{{ movie.title }}')" title="Delete Movie">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="no-data">
                <i class="fas fa-film"></i>
                <h3>No Movies Found</h3>
                <p>Start by adding your first movie to the system</p>
                <button class="btn btn-primary" onclick="showAddMovieModal()">
                    <i class="fas fa-plus"></i>
                    Add First Movie
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Add Movie Modal -->
<div id="addMovieModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3><i class="fas fa-plus"></i> Add New Movie</h3>
            <span class="close" onclick="closeModal('addMovieModal')">&times;</span>
        </div>
        
        <form action="{{ url_for('add_movie') }}" method="POST" class="modal-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="title">
                        <i class="fas fa-film"></i>
                        Movie Title
                    </label>
                    <input type="text" id="title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="duration">
                        <i class="fas fa-clock"></i>
                        Duration (minutes)
                    </label>
                    <input type="number" id="duration" name="duration" min="1" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="genre">
                        <i class="fas fa-tags"></i>
                        Genre
                    </label>
                    <select id="genre" name="genre" required>
                        <option value="">Select Genre</option>
                        <option value="Action">Action</option>
                        <option value="Adventure">Adventure</option>
                        <option value="Comedy">Comedy</option>
                        <option value="Drama">Drama</option>
                        <option value="Fantasy">Fantasy</option>
                        <option value="Horror">Horror</option>
                        <option value="Romance">Romance</option>
                        <option value="Sci-Fi">Sci-Fi</option>
                        <option value="Thriller">Thriller</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="language">
                        <i class="fas fa-language"></i>
                        Language
                    </label>
                    <select id="language" name="language" required>
                        <option value="">Select Language</option>
                        <option value="English">English</option>
                        <option value="Hindi">Hindi</option>
                        <option value="Tamil">Tamil</option>
                        <option value="Telugu">Telugu</option>
                        <option value="Malayalam">Malayalam</option>
                        <option value="Kannada">Kannada</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="release_date">
                        <i class="fas fa-calendar"></i>
                        Release Date
                    </label>
                    <input type="date" id="release_date" name="release_date" required>
                </div>
                <div class="form-group">
                    <label for="image_url">
                        <i class="fas fa-image"></i>
                        Poster URL
                    </label>
                    <input type="url" id="image_url" name="image_url" placeholder="https://example.com/poster.jpg">
                </div>
            </div>
            
            <div class="form-group">
                <label for="description">
                    <i class="fas fa-align-left"></i>
                    Description
                </label>
                <textarea id="description" name="description" rows="4" required></textarea>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-outline" onclick="closeModal('addMovieModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Add Movie
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showAddMovieModal() {
    document.getElementById('addMovieModal').style.display = 'block';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
    if (modalId === 'addMovieModal') {
        document.querySelector('#addMovieModal form').reset();
    }
}

function viewMovie(movieId) {
    window.open(`/movie/${movieId}`, '_blank');
}

function editMovie(movieId) {
    // In a real application, this would open an edit modal
    alert(`Edit functionality for movie ${movieId} would be implemented here`);
}

function deleteMovie(movieId, movieTitle) {
    if (confirm(`Are you sure you want to delete "${movieTitle}"? This action cannot be undone.`)) {
        // In a real application, this would send a DELETE request
        alert(`Delete functionality for movie ${movieId} would be implemented here`);
    }
}

// Search functionality
document.getElementById('searchMovies').addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    const tableRows = document.querySelectorAll('#moviesTable tbody tr');
    
    tableRows.forEach(row => {
        const title = row.cells[2].textContent.toLowerCase();
        const genre = row.cells[3].textContent.toLowerCase();
        
        if (title.includes(searchTerm) || genre.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});

// Genre filter
document.getElementById('genreFilter').addEventListener('change', function() {
    const selectedGenre = this.value.toLowerCase();
    const tableRows = document.querySelectorAll('#moviesTable tbody tr');
    
    tableRows.forEach(row => {
        const genre = row.cells[3].textContent.toLowerCase();
        
        if (selectedGenre === '' || genre.includes(selectedGenre)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});

// Close modal when clicking outside
window.onclick = function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (event.target === modal) {
            closeModal(modal.id);
        }
    });
}
</script>
{% endblock %}